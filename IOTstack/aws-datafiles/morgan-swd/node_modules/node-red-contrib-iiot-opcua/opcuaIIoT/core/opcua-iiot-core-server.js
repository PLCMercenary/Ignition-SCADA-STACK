"use strict";require("source-map-support").install();var de=de||{biancoroyal:{opcua:{iiot:{core:{server:{}}}}}};de.biancoroyal.opcua.iiot.core.server.core=de.biancoroyal.opcua.iiot.core.server.core||require("./opcua-iiot-core"),de.biancoroyal.opcua.iiot.core.server.internalDebugLog=de.biancoroyal.opcua.iiot.core.server.internalDebugLog||require("debug")("opcuaIIoT:server"),de.biancoroyal.opcua.iiot.core.server.detailDebugLog=de.biancoroyal.opcua.iiot.core.server.detailDebugLog||require("debug")("opcuaIIoT:server:details"),de.biancoroyal.opcua.iiot.core.server.isa95DebugLog=de.biancoroyal.opcua.iiot.core.server.isa95DebugLog||require("debug")("opcuaIIoT:server:ISA95"),de.biancoroyal.opcua.iiot.core.server.isa95DetailDebugLog=de.biancoroyal.opcua.iiot.core.server.isa95DetailDebugLog||require("debug")("opcuaIIoT:server:ISA95:details"),de.biancoroyal.opcua.iiot.core.server.flex=de.biancoroyal.opcua.iiot.core.server.flex||{},de.biancoroyal.opcua.iiot.core.server.flex.internalDebugLog=de.biancoroyal.opcua.iiot.core.server.flex.internalDebugLog||require("debug")("opcuaIIoT:server:flex"),de.biancoroyal.opcua.iiot.core.server.simulatorInterval=de.biancoroyal.opcua.iiot.core.server.simulatorInterval||null,de.biancoroyal.opcua.iiot.core.server.maxTimeInterval=de.biancoroyal.opcua.iiot.core.server.maxTimeInterval||5e5,de.biancoroyal.opcua.iiot.core.server.timeInterval=de.biancoroyal.opcua.iiot.core.server.timeInterval||1,de.biancoroyal.opcua.iiot.core.server.name=de.biancoroyal.opcua.iiot.core.server.name||"server",de.biancoroyal.opcua.iiot.core.server.simulateVariation=function(e){var a=de.biancoroyal.opcua.iiot.core.server,o=(1+Math.sin(a.timeInterval/360*3))/2;a.timeInterval++,a.timeInterval>a.maxTimeInterval&&(a.timeInterval=1),e.tankLevel&&e.tankLevel.setValueFromSource({dataType:"Double",value:o}),e.tankLevel2&&e.tankLevel2.setValueFromSource({dataType:"Double",value:o})},de.biancoroyal.opcua.iiot.core.server.constructAddressSpaceFromScript=function(o,r,n){return de.biancoroyal.opcua.iiot.core.server.flex.internalDebugLog("Construct Address Space From Script"),new Promise(function(e,a){if(o.engine&&r&&""!==r)try{r(de.biancoroyal.opcua.iiot.core.server.flex,o.engine.addressSpace,n,e)}catch(e){a(e)}else a(new Error("Wrong Parameters Construct AddressSpace From Script"))})},de.biancoroyal.opcua.iiot.core.server.constructAddressSpace=function(T,f){return new Promise(function(e,a){T||a(new Error("Server Not Valid To Construct Address Space"));var l=de.biancoroyal.opcua.iiot.core.server,o=T.engine.addressSpace;o||a(new Error("No AddressSpace From OPC UA Server Engine"));var r=o.addView({organizedBy:o.rootFolder.views,browseName:"BiancoRoyalView",displayName:"Bianco Royal View"});if(f){var n=require("../helpers/alarms-and-conditions-demo").constructAlarmAddressSpaceDemo,t={};n(t,o),de.biancoroyal.opcua.iiot.core.server.timeInterval=1,de.biancoroyal.opcua.iiot.core.server.simulatorInterval=setInterval(function(){de.biancoroyal.opcua.iiot.core.server.simulateVariation(t)},500);var i=o.addObject({organizedBy:o.rootFolder.objects,nodeId:"ns=4;i=1234",browseName:"BiancoRoyal",displayName:"Bianco Royal",description:"Bianco Royal - Software InnovationsÂ®"}),d=1;setInterval(function(){d<1e6?d+=1:d=0},100),o.addVariable({componentOf:i,nodeId:"ns=4;i=16479",browseName:"MyVariable1",dataType:"Double",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"Double",value:d})}}});var c=10;o.addVariable({componentOf:i,nodeId:"ns=4;b=1020FFAA",browseName:"MyVariable2",dataType:"Double",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"Double",value:c})},set:function(e){return c=parseFloat(e.value),l.core.nodeOPCUA.StatusCodes.Good}}});var s=1e3;o.addVariable({componentOf:i,nodeId:"ns=4;s=TestReadWrite",browseName:"TestReadWrite",displayName:"Test Read and Write",dataType:"Double",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"Double",value:s})},set:function(e){return s=parseFloat(e.value),l.core.nodeOPCUA.StatusCodes.Good}}});var u=o.addVariable({componentOf:i,nodeId:"ns=4;s=free_memory",browseName:"FreeMemory",displayName:"Free Memory",dataType:"Double",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"Double",value:l.core.availableMemory()})}}});o.installHistoricalDataNode(u);var p=0;setInterval(function(){p<65e3?p+=1:p=0},1e3);var y=o.addVariable({componentOf:i,nodeId:"ns=4;s=Counter",browseName:"Counter",dataType:"UInt16",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"UInt16",value:p})}}});o.installHistoricalDataNode(y);var v=0;setInterval(function(){v<1e5?v+=1:v=-1e5},1e3);var b=o.addVariable({componentOf:i,nodeId:"ns=4;s=FullCounter",browseName:"FullCounter",dataType:"Int32",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"Int32",value:v})}}});o.installHistoricalDataNode(b);var m=new l.core.nodeOPCUA.DataValue({value:new l.core.nodeOPCUA.Variant({dataType:"Double",value:10}),sourceTimestamp:null,sourcePicoseconds:0});setInterval(function(){m.value.value=Math.random(),m.sourceTimestamp=new Date},1e3),o.addVariable({organizedBy:i,nodeId:"ns=4;s=Pressure",browseName:"Pressure",dataType:"Double",value:{timestamped_get:function(){return m}}}),o.addVariable({organizedBy:i,nodeId:"ns=4;s=Matrix",browseName:"Matrix",dataType:"Double",valueRank:2,arrayDimensions:[3,3],value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"Double",arrayType:l.core.nodeOPCUA.VariantArrayType.Matrix,dimensions:[3,3],value:[1,2,3,4,5,6,7,8,9]})}}}),o.addVariable({organizedBy:i,nodeId:"ns=4;s=Position",browseName:"Position",dataType:"Double",valueRank:1,arrayDimensions:null,value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"Double",arrayType:l.core.nodeOPCUA.VariantArrayType.Array,value:[1,2,3,4]})}}}),o.addVariable({organizedBy:i,nodeId:"ns=4;s=PumpSpeed",browseName:"PumpSpeed",displayName:"Pump Speed",dataType:"Double",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"Double",value:200+100*Math.sin(Date.now()/1e4)})}}}),o.addVariable({organizedBy:i,nodeId:"ns=4;s=SomeDate",browseName:"SomeDate",displayName:"Some Date",dataType:"DateTime",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:l.core.nodeOPCUA.DataType.DateTime,value:new Date(Date.UTC(2016,9,13,8,40,0))})}}}),o.addVariable({organizedBy:i,nodeId:"ns=4;s=MultiLanguageText",browseName:"MultiLanguageText",displayName:"Multi Language Text",dataType:"LocalizedText",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:l.core.nodeOPCUA.DataType.LocalizedText,value:[{text:"multilingual text",locale:"en"},{text:"mehrsprachiger Text",locale:"de"},{text:"texte multilingue",locale:"fr"}]})}}});var g=o.addVariable({organizedBy:i,nodeId:"ns=4;s=FanSpeed",browseName:"FanSpeed",dataType:"Double",value:new l.core.nodeOPCUA.Variant({dataType:"Double",value:1e3})});setInterval(function(){g.setValueFromSource(new l.core.nodeOPCUA.Variant({dataType:"Double",value:100*Math.random()-50+1e3}))},10),o.addMethod(i,{nodeId:"ns=4;i=12345",browseName:"Bark",inputArguments:[{name:"barks",dataType:"UInt32",arrayType:l.core.nodeOPCUA.VariantArrayType.Scalar,description:{text:"specifies the number of time I should bark"}},{name:"volume",dataType:"UInt32",arrayType:l.core.nodeOPCUA.VariantArrayType.Scalar,description:{text:"specifies the sound volume [0 = quiet ,100 = loud]"}}],outputArguments:[{name:"Barks",dataType:"String",arrayType:l.core.nodeOPCUA.VariantArrayType.Array,description:{text:"the generated barks"},valueRank:1}]}).bindMethod(function(e,a,o){for(var r=e[0].value,n=e[1].value,t=new Array(n).join("!"),i=[],d=0;d<r;d++)i.push("Whaff"+t);o(null,{statusCode:l.core.nodeOPCUA.StatusCodes.Good,outputArguments:[{dataType:l.core.nodeOPCUA.DataType.String,arrayType:l.core.nodeOPCUA.VariantArrayType.Array,value:i}]})});var D=o.addAnalogDataItem({organizedBy:i,nodeId:"ns=1;s=TemperatureAnalogItem",browseName:"TemperatureAnalogItem",definition:"(tempA -25) + tempB",valuePrecision:.5,engineeringUnitsRange:{low:100,high:200},instrumentRange:{low:-100,high:200},engineeringUnits:l.core.nodeOPCUA.standardUnits.degree_celsius,dataType:"Double",value:{get:function(){return new l.core.nodeOPCUA.Variant({dataType:"Double",value:Math.random()+19})}}});r.addReference({referenceType:"Organizes",nodeId:D.nodeId}),e()}else e()})},de.biancoroyal.opcua.iiot.core.server.start=function(n,t){var i=this;return new Promise(function(o,r){n||r(new Error("Server Not Valid To Start")),t||r(new Error("Node Not Valid To Start")),n.start(function(e){if(e)r(e);else{if(t.initialized=!0,n.endpoints){n.endpoints.forEach(function(e){e.endpointDescriptions().forEach(function(e){i.internalDebugLog("Server endpointUrl: "+e.endpointUrl+" securityMode: "+e.securityMode.toString()+" securityPolicyUri: "+e.securityPolicyUri?e.securityPolicyUri.toString():"None Security Policy Uri")})});var a=n.endpoints[0].endpointDescriptions()[0].endpointUrl;i.internalDebugLog("Primary Server Endpoint URL "+a)}n.on("newChannel",function(e){i.internalDebugLog("Client connected with address = "+e.remoteAddress+" port = "+e.remotePort)}),n.on("closeChannel",function(e){i.internalDebugLog("Client disconnected with address = "+e.remoteAddress+" port = "+e.remotePort)}),n.on("create_session",function(e){i.internalDebugLog("############## SESSION CREATED ##############"),e.clientDescription&&(i.detailDebugLog("Client application URI:"+e.clientDescription.applicationUri),i.detailDebugLog("Client product URI:"+e.clientDescription.productUri),i.detailDebugLog((e.clientDescription.applicationName,e.clientDescription.applicationName.toString())),i.detailDebugLog((e.clientDescription.applicationType,e.clientDescription.applicationType.toString()))),i.internalDebugLog((e.sessionName,e.sessionName.toString())),i.internalDebugLog("Session timeout:"+e.sessionTimeout),i.internalDebugLog("Session id:"+e.sessionId)}),n.on("session_closed",function(e,a){i.internalDebugLog("############## SESSION CLOSED ##############"),i.internalDebugLog("reason:"+a),i.internalDebugLog((e.sessionName,e.sessionName.toString()))}),i.internalDebugLog("Server Initialized"),n.serverInfo&&i.detailDebugLog("Server Info:"+JSON.stringify(n.serverInfo)),o()}})})},module.exports=de.biancoroyal.opcua.iiot.core.server;
//# sourceMappingURL=../maps/core/opcua-iiot-core-server.js.map
