{"version":3,"sources":["opcua-iiot-node.js"],"names":["module","exports","RED","install","require","nodes","registerType","config","OPCUAIIoTNode","createNode","nodeId","this","datatype","value","topic","name","injectType","node","status","fill","shape","text","on","msg","nodetype","subscribed","valuesToWrite","datatypeName","push","core","convertDataValueByDataType","payload","internalDebugLog","err","showErrors","addressSpaceItems","JSON","stringify"],"mappings":"AAQA,aAOAA,OAAOC,QAAU,SAAUC,GAA3BF,QAAOC,sBAAyBE,UAC9BC,IAAAA,EAAQA,QAAA,0BAyDRF,EAAIG,MAAMC,aAAa,kBAtDvB,SAAwBC,GAAxBL,EAAAG,MAASG,WAAeD,KAAxBA,GACEL,KAAIG,OAAMI,EAAWC,OACrBC,KAAKD,SAASH,EAAOG,SACrBC,KAAKC,MAALL,EAAgBA,MAChBI,KAAKE,MAAQN,EAAOM,MACpBF,KAAKG,KAALP,EAAaA,KACbI,KAAKI,WAAOR,EAAZS,WACAL,KAAKK,WAAaT,EAAOS,WAGzB,IAAIC,EAAON,KAAXM,EAAIA,YAAJ,EAGAA,EAAKC,OAAO,CAACC,KAAM,OAAQC,MAAO,OAAQC,KAAM,QAEhDJ,EAAKK,GAAG,QAAS,SAAUC,GAkBzB,GAlBFN,EAAKK,SAAY,OACfC,EAAIC,WAAWD,EAAfP,YAAAC,EAAAD,WACAO,EAAIP,YAAaO,EAAIP,WAGG,WAApBC,EAAKD,WAALC,EAAKD,WACPC,EAAIA,OAAKQ,CAAAA,KAAY,OAAAL,MAAA,MAAAC,KAAA,eAArBJ,EAEOC,OAAA,CAAAC,KAAA,OAAAC,MAAA,OAAAC,KAAA,mBAHTJ,EAMOC,OAAA,CAAAC,KAAA,OAAAC,MAAA,MAAAC,KAAA,aAIPE,EAAIT,MAAQS,EAAIT,OAASG,EAAKH,MAA9BS,EAAIT,kBAAQS,EAAaN,mBAAzB,GAGwB,UAApBA,EAAKD,WAAwB,CAAjCO,EAAIN,cAAAM,EAAoBG,eAAS,GAC/BH,EAAIG,kBAAgBH,KAAIG,CAAAA,KAAAA,EAAJX,KAAwBL,OAAAO,EAAAP,OAAAiB,aAAAV,EAAAL,WAG5C,IAAAW,EAAIG,cAAAE,KAAAC,EAAAC,2BAAA,CAAAjB,MAAAU,EAAAQ,SAAAd,EAAAJ,OAAAI,EAAAL,WACFW,MAAIG,GACJG,EAAAG,iBAAYC,GACZJ,EAAKG,YACLf,EAAIA,MAAKiB,EAAAA,SARbX,EAAAY,kBAYOP,KAAA,CAAAb,KAAAE,EAAAF,KAAAL,OAAAO,EAAAP,OAAAiB,aAAAV,EAAAL,WAIPiB,EAAKG,iBAAiB,yBAA2BI,KAAKC,UAAUd,IAAhEM,EAAKG,KAAAA","file":"../opcua-iiot-node.js","sourcesContent":["/*\n The BSD 3-Clause License\n\n Copyright 2016,2017,2018 - Klaus Landsdorf (http://bianco-royal.de/)\n Copyright 2015,2016 - Mika Karaila, Valmet Automation Inc. (node-red-contrib-opcua)\n All rights reserved.\n node-red-contrib-iiot-opcua\n */\n'use strict'\n\n/**\n * OPC UA node representation for Node-RED OPC UA IIoT nodes.\n *\n * @param RED\n */\nmodule.exports = function (RED) {\n  require('source-map-support').install()\n  let core = require('./core/opcua-iiot-core')\n\n  function OPCUAIIoTNode (config) {\n    RED.nodes.createNode(this, config)\n    this.nodeId = config.nodeId\n    this.datatype = config.datatype\n    this.value = config.value\n    this.topic = config.topic\n    this.name = config.name\n    this.injectType = config.injectType\n    this.showErrors = config.showErrors\n\n    let node = this\n    node.subscribed = false\n\n    node.status({fill: 'blue', shape: 'ring', text: 'new'})\n\n    node.on('input', function (msg) {\n      msg.nodetype = 'node'\n      msg.injectType = msg.injectType || node.injectType\n      node.subscribed = !node.subscribed\n\n      if (node.injectType === 'listen') {\n        if (node.subscribed) {\n          node.status({fill: 'blue', shape: 'dot', text: 'subscribed'})\n        } else {\n          node.status({fill: 'blue', shape: 'ring', text: 'not subscribed'})\n        }\n      } else {\n        node.status({fill: 'blue', shape: 'dot', text: 'injected'})\n      }\n\n      msg.topic = msg.topic || node.topic\n      msg.addressSpaceItems = msg.addressSpaceItems || [] // eslint-disable-line\n\n      if (node.injectType === 'write') {\n        msg.valuesToWrite = msg.valuesToWrite || [] // eslint-disable-line\n        msg.addressSpaceItems.push({name: node.name, nodeId: node.nodeId, datatypeName: node.datatype})\n\n        try {\n          msg.valuesToWrite.push(core.convertDataValueByDataType({value: msg.payload || node.value}, node.datatype))\n        } catch (err) {\n          core.internalDebugLog(err)\n          if (node.showErrors) {\n            node.error(err, msg)\n          }\n        }\n      } else {\n        msg.addressSpaceItems.push({name: node.name, nodeId: node.nodeId, datatypeName: node.datatype})\n      }\n\n      core.internalDebugLog('node msg stringified: ' + JSON.stringify(msg))\n      node.send(msg)\n    })\n  }\n\n  RED.nodes.registerType('OPCUA-IIoT-Node', OPCUAIIoTNode)\n}\n"]}